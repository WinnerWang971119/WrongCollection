# è‡ªè¨‚è¤‡ç¿’åŠŸèƒ½ - å®Œæ•´èªªæ˜æ–‡ä»¶

## ğŸ“… å®Œæˆæ—¥æœŸ
2025-01-05

---

## âœ… åŠŸèƒ½æ¦‚è¿°

**è‡ªè¨‚è¤‡ç¿’åŠŸèƒ½** å…è¨±ä½¿ç”¨è€…è‡ªç”±è¨­å®šç¯©é¸æ¢ä»¶ï¼Œé¸æ“‡æƒ³è¦è¤‡ç¿’çš„é¡Œç›®ï¼Œè€Œä¸å±€é™æ–¼ç³»çµ±æ¨è–¦çš„ä»Šæ—¥è¤‡ç¿’ä½‡åˆ—ã€‚

### æ ¸å¿ƒç‰¹è‰²
- ğŸ“ **è³‡æ–™å¤¾ç¯©é¸**ï¼šå¤šé¸è³‡æ–™å¤¾ï¼ˆæ”¯æ´éšå±¤é¡¯ç¤ºï¼‰
- â­ **é›£åº¦ç¯©é¸**ï¼šç°¡å–®ã€ä¸­ç­‰ã€å›°é›£
- ğŸ”„ **è¤‡ç¿’ç‹€æ…‹ç¯©é¸**ï¼šæ–°é¡Œç›®ã€å­¸ç¿’ä¸­ã€è¤‡ç¿’ä¸­ã€å·²ç²¾é€š
- ğŸ“… **æ™‚é–“ç¯„åœç¯©é¸**ï¼šä»Šå¤©ã€3å¤©å…§ã€7å¤©å…§ã€14å¤©å…§ã€30å¤©å…§ã€å…¨éƒ¨
- ğŸ¯ **éŒ¯èª¤æ¬¡æ•¸ç¯„åœ**ï¼šå¯è¨­å®š 0-20 æ¬¡çš„ç¯„åœ
- ğŸ“Š **æ•¸é‡é™åˆ¶**ï¼š10ã€20ã€30ã€50ã€100 é¡Œ
- ğŸ‘ï¸ **å³æ™‚é è¦½**ï¼šé¡¯ç¤ºç¬¦åˆæ¢ä»¶çš„é¡Œç›®æ•¸é‡

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### 1. Backend API
**è·¯å¾‘**: `app/api/questions/custom-review/route.ts`

```typescript
POST /api/questions/custom-review
```

**è«‹æ±‚ Body**:
```json
{
  "folder_ids": ["uuid1", "uuid2"],        // å¯é¸ï¼šè³‡æ–™å¤¾ ID é™£åˆ—
  "difficulties": ["easy", "medium"],      // å¯é¸ï¼šé›£åº¦é™£åˆ—
  "review_states": ["new", "learning"],    // å¯é¸ï¼šè¤‡ç¿’ç‹€æ…‹é™£åˆ—
  "days_since_review": 7,                  // å¯é¸ï¼šè·é›¢ä¸Šæ¬¡è¤‡ç¿’å¤©æ•¸
  "min_wrong_count": 0,                    // å¯é¸ï¼šæœ€å°éŒ¯èª¤æ¬¡æ•¸
  "max_wrong_count": 10,                   // å¯é¸ï¼šæœ€å¤§éŒ¯èª¤æ¬¡æ•¸
  "limit": 50                              // å¯é¸ï¼šæœ€å¤šè¿”å›é¡Œæ•¸ï¼ˆé è¨­ 50ï¼‰
}
```

**å›æ‡‰**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "title": "é¡Œç›®æ¨™é¡Œ",
      "difficulty": "medium",
      "wrong_count": 3,
      "review_state": "learning",
      "next_review_date": "2025-01-06T10:00:00Z",
      "last_reviewed_at": "2025-01-05T10:00:00Z",
      "created_at": "2025-01-01T10:00:00Z"
    }
  ],
  "count": 25
}
```

**å¯¦ä½œç´°ç¯€**:
1. **è³‡æ–™å¤¾ç¯©é¸**ï¼šJOIN `question_folders` è¡¨ï¼Œç¯©é¸ folder_id IN (...)
2. **é›£åº¦ç¯©é¸**ï¼šç›´æ¥ IN clause ç¯©é¸
3. **ç‹€æ…‹ç¯©é¸**ï¼šç›´æ¥ IN clause ç¯©é¸
4. **æ™‚é–“ç¯©é¸**ï¼šè¨ˆç®—ç›®æ¨™æ—¥æœŸï¼Œç¯©é¸ last_reviewed_at OR NULL
5. **éŒ¯èª¤æ¬¡æ•¸**ï¼šgte/lte ç¯„åœç¯©é¸
6. **æ’åº**ï¼šwrong_count DESC, created_at ASC
7. **é™åˆ¶**ï¼šä½¿ç”¨ limit åƒæ•¸

---

### 2. Client API Function
**è·¯å¾‘**: `lib/api/question.api.ts`

```typescript
export async function getCustomReviewQuestions(filters: {
  folder_ids?: string[];
  difficulties?: string[];
  review_states?: string[];
  days_since_review?: number;
  min_wrong_count?: number;
  max_wrong_count?: number;
  limit?: number;
}): Promise<any[]>
```

**åŠŸèƒ½**:
- å‘¼å« POST /api/questions/custom-review
- è™•ç†éŒ¯èª¤ä¸¦æ‹‹å‡º
- è¿”å›é¡Œç›®é™£åˆ—

---

### 3. UI Component
**è·¯å¾‘**: `components/questions/CustomReviewDialog.tsx`

#### å…ƒä»¶ Props
```typescript
interface CustomReviewDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onStartReview: (questions: any[]) => void;
}
```

#### ç‹€æ…‹ç®¡ç†
```typescript
const [folders, setFolders] = useState<FolderTreeNode[]>([]);
const [selectedFolders, setSelectedFolders] = useState<string[]>([]);
const [selectedDifficulties, setSelectedDifficulties] = useState<string[]>([]);
const [selectedStates, setSelectedStates] = useState<string[]>([]);
const [daysSinceReview, setDaysSinceReview] = useState<number | undefined>(undefined);
const [wrongCountRange, setWrongCountRange] = useState<[number, number]>([0, 20]);
const [limit, setLimit] = useState<number>(50);
const [previewCount, setPreviewCount] = useState<number>(0);
```

#### UI å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ è‡ªè¨‚è¤‡ç¿’é¡Œç›®                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ è³‡æ–™å¤¾ï¼ˆå¤šé¸ + éšå±¤é¡¯ç¤ºï¼‰         â”‚
â”‚  â­ é›£åº¦ï¼ˆæŒ‰éˆ•åˆ‡æ›ï¼‰                  â”‚
â”‚  ğŸ”„ è¤‡ç¿’ç‹€æ…‹ï¼ˆæŒ‰éˆ•åˆ‡æ›ï¼‰              â”‚
â”‚  ğŸ“… è·é›¢ä¸Šæ¬¡è¤‡ç¿’ï¼ˆä¸‹æ‹‰é¸å–®ï¼‰          â”‚
â”‚  ğŸ¯ éŒ¯èª¤æ¬¡æ•¸ç¯„åœï¼ˆæ»‘æ¡¿ï¼‰              â”‚
â”‚  ğŸ“Š æœ€å¤šè¤‡ç¿’é¡Œæ•¸ï¼ˆä¸‹æ‹‰é¸å–®ï¼‰          â”‚
â”‚  âœ¨ ç¬¦åˆæ¢ä»¶çš„é¡Œç›®ï¼šXX é¡Œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é‡ç½®ç¯©é¸]  [å–æ¶ˆ]  [é–‹å§‹è¤‡ç¿’(XXé¡Œ)]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Integration with ReviewQueue
**è·¯å¾‘**: `components/questions/ReviewQueue.tsx`

**æ–°å¢åŠŸèƒ½**:
1. **è‡ªè¨‚è¤‡ç¿’æŒ‰éˆ•**ï¼šåœ¨æ¨™é¡Œåˆ—å³å´æ–°å¢ã€Œâš™ï¸ è‡ªè¨‚è¤‡ç¿’ã€æŒ‰éˆ•
2. **æ¨¡å¼åˆ‡æ›**ï¼šæ”¯æ´ã€Œä»Šæ—¥è¤‡ç¿’ä½‡åˆ—ã€å’Œã€Œè‡ªè¨‚è¤‡ç¿’ã€å…©ç¨®æ¨¡å¼
3. **ç‹€æ…‹é¡¯ç¤º**ï¼šæ¨™é¡Œå‹•æ…‹é¡¯ç¤ºç•¶å‰æ¨¡å¼
4. **é‡ç½®åŠŸèƒ½**ï¼šé»æ“Šåˆ·æ–°æŒ‰éˆ•å›åˆ°ä»Šæ—¥ä½‡åˆ—æ¨¡å¼

**ç¨‹å¼ç¢¼**:
```tsx
const [showCustomDialog, setShowCustomDialog] = useState(false);
const [isCustomMode, setIsCustomMode] = useState(false);

const handleCustomReview = (customQuestions: any[]) => {
  setQuestions(customQuestions);
  setIsCustomMode(true);
  setCompletedCount(0);
  toast.success(`âœ… å·²è¼‰å…¥ ${customQuestions.length} é¡Œè‡ªè¨‚è¤‡ç¿’é¡Œç›®`);
};

// UI ä¸­
<Button onClick={() => setShowCustomDialog(true)}>
  <Settings className="h-4 w-4" />
  è‡ªè¨‚è¤‡ç¿’
</Button>

<CustomReviewDialog
  open={showCustomDialog}
  onOpenChange={setShowCustomDialog}
  onStartReview={handleCustomReview}
/>
```

---

## ğŸ“– ä½¿ç”¨æµç¨‹

### 1. é–‹å•Ÿè‡ªè¨‚è¤‡ç¿’å°è©±æ¡†
- é»æ“Šã€Œæ™ºæ…§è¤‡ç¿’ã€é é¢å³ä¸Šè§’çš„ã€Œâš™ï¸ è‡ªè¨‚è¤‡ç¿’ã€æŒ‰éˆ•
- å°è©±æ¡†é–‹å•Ÿï¼Œè‡ªå‹•è¼‰å…¥ä½¿ç”¨è€…çš„è³‡æ–™å¤¾åˆ—è¡¨

### 2. è¨­å®šç¯©é¸æ¢ä»¶

#### ğŸ“ é¸æ“‡è³‡æ–™å¤¾ï¼ˆå¯é¸ï¼‰
- é¡¯ç¤ºæ¨¹ç‹€éšå±¤çµæ§‹ï¼ˆä½¿ç”¨ paddingLeft ç¸®æ’ï¼‰
- æ”¯æ´å¤šé¸ï¼ˆCheckboxï¼‰
- é¡¯ç¤ºå·²é¸æ“‡æ•¸é‡
- ä¾‹ï¼šé¸æ“‡ã€Œæ•¸å­¸ã€å’Œã€Œç‰©ç†ã€è³‡æ–™å¤¾

#### â­ é¸æ“‡é›£åº¦ï¼ˆå¯é¸ï¼‰
- ä¸‰å€‹æŒ‰éˆ•ï¼šâ­ ç°¡å–®ã€â­â­ ä¸­ç­‰ã€â­â­â­ å›°é›£
- å¯å¤šé¸ï¼ˆæŒ‰éˆ•åˆ‡æ› variantï¼‰
- é è¨­ä¸é¸ï¼ˆå…¨é¸ï¼‰
- ä¾‹ï¼šé¸æ“‡ã€Œä¸­ç­‰ã€å’Œã€Œå›°é›£ã€

#### ğŸ”„ é¸æ“‡è¤‡ç¿’ç‹€æ…‹ï¼ˆå¯é¸ï¼‰
- å››å€‹æŒ‰éˆ•ï¼šæ–°é¡Œç›®ã€å­¸ç¿’ä¸­ã€è¤‡ç¿’ä¸­ã€å·²ç²¾é€š
- ä¸åŒé¡è‰²æ¨™è¨˜ï¼ˆè—ã€é»ƒã€ç¶ ã€ç´«ï¼‰
- å¯å¤šé¸
- é è¨­ä¸é¸ï¼ˆå…¨é¸ï¼‰
- ä¾‹ï¼šé¸æ“‡ã€Œå­¸ç¿’ä¸­ã€å’Œã€Œè¤‡ç¿’ä¸­ã€

#### ğŸ“… é¸æ“‡æ™‚é–“ç¯„åœï¼ˆå¯é¸ï¼‰
- ä¸‹æ‹‰é¸å–®ï¼šå…¨éƒ¨ã€ä»Šå¤©ã€3å¤©å…§ã€7å¤©å…§ã€14å¤©å…§ã€30å¤©å…§
- é è¨­ï¼šå…¨éƒ¨
- ä¾‹ï¼šé¸æ“‡ã€Œ7å¤©å…§ã€ï¼ˆéå» 7 å¤©æœªè¤‡ç¿’çš„é¡Œç›®ï¼‰

#### ğŸ¯ è¨­å®šéŒ¯èª¤æ¬¡æ•¸ç¯„åœï¼ˆå¯é¸ï¼‰
- é›™å‘æ»‘æ¡¿ï¼š0-20 æ¬¡
- é è¨­ï¼š0-20ï¼ˆå…¨é¸ï¼‰
- å³æ™‚é¡¯ç¤ºç•¶å‰ç¯„åœ
- ä¾‹ï¼šè¨­å®š 3-10 æ¬¡ï¼ˆåªè¤‡ç¿’éŒ¯èª¤ 3-10 æ¬¡çš„é¡Œç›®ï¼‰

#### ğŸ“Š è¨­å®šæœ€å¤šé¡Œæ•¸
- ä¸‹æ‹‰é¸å–®ï¼š10ã€20ã€30ã€50ã€100 é¡Œ
- é è¨­ï¼š50 é¡Œ
- ä¾‹ï¼šé¸æ“‡ã€Œ30 é¡Œã€

### 3. é è¦½é¡Œç›®æ•¸é‡
- æ¯æ¬¡ä¿®æ”¹ç¯©é¸æ¢ä»¶ï¼Œè‡ªå‹•è¨ˆç®—ç¬¦åˆçš„é¡Œç›®æ•¸é‡
- å³æ™‚é¡¯ç¤ºåœ¨åº•éƒ¨é è¦½å€åŸŸ
- ä¾‹ï¼šã€Œç¬¦åˆæ¢ä»¶çš„é¡Œç›®ï¼š25 é¡Œã€
- æç¤ºï¼šã€Œå°‡è¤‡ç¿’ 25 é¡Œï¼ˆæœ€å¤š 30 é¡Œï¼‰ã€

### 4. é–‹å§‹è¤‡ç¿’
- é»æ“Šã€Œé–‹å§‹è¤‡ç¿’ (25 é¡Œ)ã€æŒ‰éˆ•
- è¼‰å…¥ç¬¦åˆæ¢ä»¶çš„é¡Œç›®
- å°è©±æ¡†é—œé–‰
- ReviewQueue åˆ‡æ›ç‚ºã€Œè‡ªè¨‚è¤‡ç¿’ã€æ¨¡å¼
- é¡¯ç¤ºè‡ªè¨‚é¡Œç›®åˆ—è¡¨
- é–‹å§‹è¤‡ç¿’æµç¨‹ï¼ˆèˆ‡ä»Šæ—¥ä½‡åˆ—ç›¸åŒï¼‰

### 5. è¿”å›ä»Šæ—¥ä½‡åˆ—
- é»æ“Šå³ä¸Šè§’ã€ŒğŸ”„ã€åˆ·æ–°æŒ‰éˆ•
- è‡ªå‹•åˆ‡æ›å›ã€Œä»Šæ—¥è¤‡ç¿’ä½‡åˆ—ã€æ¨¡å¼
- è¼‰å…¥ç³»çµ±æ¨è–¦é¡Œç›®

---

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1: é‡å°æ€§è¤‡ç¿’
**éœ€æ±‚**: æˆ‘æƒ³å°ˆé–€è¤‡ç¿’ã€Œæ•¸å­¸ã€è³‡æ–™å¤¾ä¸­çš„å›°é›£é¡Œ

**æ“ä½œ**:
1. é¸æ“‡è³‡æ–™å¤¾ï¼šâœ… æ•¸å­¸
2. é¸æ“‡é›£åº¦ï¼šâœ… å›°é›£
3. å…¶ä»–ï¼šé è¨­
4. é–‹å§‹è¤‡ç¿’

**çµæœ**: åªè¤‡ç¿’æ•¸å­¸è³‡æ–™å¤¾ä¸­çš„å›°é›£é¡Œ

---

### å ´æ™¯ 2: å¸¸éŒ¯é¡ŒåŠ å¼·
**éœ€æ±‚**: æˆ‘æƒ³è¤‡ç¿’éŒ¯èª¤ 5 æ¬¡ä»¥ä¸Šçš„é¡Œç›®

**æ“ä½œ**:
1. éŒ¯èª¤æ¬¡æ•¸ç¯„åœï¼š5-20
2. å…¶ä»–ï¼šé è¨­
3. é–‹å§‹è¤‡ç¿’

**çµæœ**: åªè¤‡ç¿’éŒ¯èª¤ 5 æ¬¡ä»¥ä¸Šçš„é¡Œç›®

---

### å ´æ™¯ 3: é•·æ™‚é–“æœªè¤‡ç¿’é¡Œç›®
**éœ€æ±‚**: æˆ‘æƒ³è¤‡ç¿’è¶…é 7 å¤©æ²’è¤‡ç¿’çš„é¡Œç›®

**æ“ä½œ**:
1. è·é›¢ä¸Šæ¬¡è¤‡ç¿’ï¼š7 å¤©å…§
2. è¤‡ç¿’ç‹€æ…‹ï¼šâœ… å­¸ç¿’ä¸­ã€âœ… è¤‡ç¿’ä¸­ï¼ˆæ’é™¤æ–°é¡Œç›®å’Œå·²ç²¾é€šï¼‰
3. é–‹å§‹è¤‡ç¿’

**çµæœ**: è¤‡ç¿’è¶…é 7 å¤©æœªè¤‡ç¿’çš„å­¸ç¿’ä¸­å’Œè¤‡ç¿’ä¸­é¡Œç›®

---

### å ´æ™¯ 4: éš¨æ©Ÿè¤‡ç¿’
**éœ€æ±‚**: æˆ‘æƒ³éš¨æ©Ÿè¤‡ç¿’ 20 é¡Œ

**æ“ä½œ**:
1. æœ€å¤šé¡Œæ•¸ï¼š20 é¡Œ
2. å…¶ä»–ï¼šä¸ç¯©é¸ï¼ˆå…¨éƒ¨ï¼‰
3. é–‹å§‹è¤‡ç¿’

**çµæœ**: éš¨æ©Ÿè¤‡ç¿’ 20 é¡Œï¼ˆæŒ‰éŒ¯èª¤æ¬¡æ•¸å’Œå‰µå»ºæ™‚é–“æ’åºï¼‰

---

### å ´æ™¯ 5: æ–°é¡Œç›®å­¸ç¿’
**éœ€æ±‚**: æˆ‘æƒ³å­¸ç¿’æ‰€æœ‰æ–°é¡Œç›®

**æ“ä½œ**:
1. è¤‡ç¿’ç‹€æ…‹ï¼šâœ… æ–°é¡Œç›®
2. å…¶ä»–ï¼šé è¨­
3. é–‹å§‹è¤‡ç¿’

**çµæœ**: åªè¤‡ç¿’å¾æœªè¤‡ç¿’éçš„æ–°é¡Œç›®

---

## ğŸ§ª æ¸¬è©¦æ¸…å–®

### âœ… Backend API æ¸¬è©¦
- [x] ç„¡ç¯©é¸æ¢ä»¶ï¼ˆè¿”å›å…¨éƒ¨ï¼‰
- [x] å–®ä¸€è³‡æ–™å¤¾ç¯©é¸
- [x] å¤šè³‡æ–™å¤¾ç¯©é¸
- [x] é›£åº¦ç¯©é¸ï¼ˆå–®ä¸€ã€å¤šå€‹ï¼‰
- [x] è¤‡ç¿’ç‹€æ…‹ç¯©é¸ï¼ˆå–®ä¸€ã€å¤šå€‹ï¼‰
- [x] æ™‚é–“ç¯„åœç¯©é¸ï¼ˆå„ç¨®å¤©æ•¸ï¼‰
- [x] éŒ¯èª¤æ¬¡æ•¸ç¯„åœç¯©é¸
- [x] è¤‡åˆç¯©é¸ï¼ˆå¤šæ¢ä»¶çµ„åˆï¼‰
- [x] Limit é™åˆ¶åŠŸèƒ½
- [x] ç©ºçµæœè™•ç†
- [x] èªè­‰æª¢æŸ¥

### âœ… Frontend æ¸¬è©¦
- [x] è³‡æ–™å¤¾è¼‰å…¥å’Œé¡¯ç¤ºï¼ˆéšå±¤çµæ§‹ï¼‰
- [x] è³‡æ–™å¤¾å¤šé¸åŠŸèƒ½
- [x] é›£åº¦æŒ‰éˆ•åˆ‡æ›
- [x] ç‹€æ…‹æŒ‰éˆ•åˆ‡æ›
- [x] æ™‚é–“ä¸‹æ‹‰é¸å–®
- [x] æ»‘æ¡¿ç¯„åœè¨­å®š
- [x] æ•¸é‡ä¸‹æ‹‰é¸å–®
- [x] å³æ™‚é è¦½è¨ˆç®—
- [x] é–‹å§‹è¤‡ç¿’æŒ‰éˆ•ï¼ˆç¦ç”¨ç‹€æ…‹ï¼‰
- [x] é‡ç½®ç¯©é¸æŒ‰éˆ•
- [x] å–æ¶ˆæŒ‰éˆ•
- [x] Loading ç‹€æ…‹
- [x] éŒ¯èª¤æç¤ºï¼ˆToastï¼‰
- [x] éŸ¿æ‡‰å¼å¸ƒå±€

### âœ… Integration æ¸¬è©¦
- [x] ReviewQueue æ•´åˆ
- [x] è‡ªè¨‚è¤‡ç¿’æŒ‰éˆ•
- [x] æ¨¡å¼åˆ‡æ›ï¼ˆä»Šæ—¥ â†” è‡ªè¨‚ï¼‰
- [x] é¡Œç›®åˆ—è¡¨æ›¿æ›
- [x] åˆ·æ–°è¿”å›ä»Šæ—¥ä½‡åˆ—
- [x] è¤‡ç¿’æµç¨‹ï¼ˆèˆ‡ä»Šæ—¥ä½‡åˆ—ç›¸åŒï¼‰

---

## ğŸ“Š è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User è¨­å®šç¯©é¸ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ (useEffect è‡ªå‹•è§¸ç™¼)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ previewQuestions â”‚ â† å‘¼å« getCustomReviewQuestions
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ (å¾Œç«¯æŸ¥è©¢)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/questions/    â”‚
â”‚   custom-review         â”‚
â”‚ - Supabase query        â”‚
â”‚ - æ¢ä»¶ç¯©é¸              â”‚
â”‚ - JOIN question_folders â”‚
â”‚ - æ’åº                  â”‚
â”‚ - Limit                 â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“ (è¿”å›çµæœ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setPreviewCount â”‚ â† æ›´æ–°é è¦½æ•¸é‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½¿ç”¨è€…é»æ“Šã€Œé–‹å§‹è¤‡ç¿’ã€
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleStartReview  â”‚ â† å‘¼å« getCustomReviewQuestions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ (å¾Œç«¯æŸ¥è©¢ï¼Œå¥—ç”¨ limit)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/questions/    â”‚
â”‚   custom-review         â”‚
â”‚ - å¥—ç”¨ä½¿ç”¨è€…è¨­å®šçš„ limit â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â†“ (è¿”å›çµæœ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onStartReview   â”‚ â† å‚³éé¡Œç›®é™£åˆ—çµ¦ ReviewQueue
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ (æ›´æ–°ç‹€æ…‹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReviewQueue        â”‚
â”‚ - setQuestions     â”‚
â”‚ - setIsCustomMode  â”‚
â”‚ - setCompletedCountâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ UI æˆªåœ–èªªæ˜

### 1. é–‹å•Ÿå°è©±æ¡†
- é¡¯ç¤ºã€Œâš™ï¸ è‡ªè¨‚è¤‡ç¿’é¡Œç›®ã€æ¨™é¡Œ
- è¼‰å…¥è³‡æ–™å¤¾åˆ—è¡¨ï¼ˆæ¨¹ç‹€çµæ§‹ï¼‰
- æ‰€æœ‰ç¯©é¸å™¨é è¨­ç‚ºæœªé¸æ“‡
- é è¦½é¡¯ç¤ºç¸½é¡Œç›®æ•¸

### 2. è¨­å®šè³‡æ–™å¤¾ç¯©é¸
- Checkbox é¸æ“‡è³‡æ–™å¤¾
- ç¸®æ’é¡¯ç¤ºéšå±¤ï¼ˆæ¯å±¤ 16pxï¼‰
- åº•éƒ¨é¡¯ç¤ºã€Œå·²é¸æ“‡ X å€‹è³‡æ–™å¤¾ã€

### 3. è¨­å®šå…¶ä»–ç¯©é¸
- é›£åº¦æŒ‰éˆ•ï¼šé¸ä¸­æ™‚è—è‰²åº•è‰²
- ç‹€æ…‹æŒ‰éˆ•ï¼šé¸ä¸­æ™‚è—è‰²åº•è‰²ï¼Œé¡è‰²é»æ¨™è¨˜
- æ™‚é–“ä¸‹æ‹‰ï¼šå±•é–‹é¡¯ç¤ºé¸é …
- æ»‘æ¡¿ï¼šæ‹–å‹•é¡¯ç¤ºç¯„åœ

### 4. é è¦½å€åŸŸ
- è—è‰²èƒŒæ™¯å€å¡Š
- é¡¯ç¤ºã€Œâœ¨ ç¬¦åˆæ¢ä»¶çš„é¡Œç›®ï¼šXX é¡Œã€
- é¡¯ç¤ºã€Œå°‡è¤‡ç¿’ XX é¡Œï¼ˆæœ€å¤š XX é¡Œï¼‰ã€

### 5. é–‹å§‹è¤‡ç¿’
- æŒ‰éˆ•æ–‡å­—ï¼šã€Œé–‹å§‹è¤‡ç¿’ (XX é¡Œ)ã€
- é»æ“Šå¾Œå°è©±æ¡†é—œé–‰
- ReviewQueue æ¨™é¡Œè®Šç‚ºã€Œè‡ªè¨‚è¤‡ç¿’ã€

---

## ğŸš€ æ•ˆèƒ½å„ªåŒ–

### 1. è³‡æ–™åº«æŸ¥è©¢
- âœ… ä½¿ç”¨ JOIN è€Œéå¤šæ¬¡æŸ¥è©¢
- âœ… ç´¢å¼•å„ªåŒ–ï¼ˆfolder_id, review_state, difficultyï¼‰
- âœ… Limit é™åˆ¶è¿”å›æ•¸é‡
- âš ï¸ æœªä¾†è€ƒæ…®ï¼šå¿«å–å¸¸ç”¨ç¯©é¸çµæœ

### 2. å‰ç«¯æ•ˆèƒ½
- âœ… useEffect è‡ªå‹•é è¦½ï¼ˆé¿å…é‡è¤‡æ‰‹å‹•è§¸ç™¼ï¼‰
- âœ… Debounce æ»‘æ¡¿è®ŠåŒ–ï¼ˆç›®å‰ç„¡ï¼Œå¯è€ƒæ…®æ–°å¢ï¼‰
- âœ… è™›æ“¬æ»¾å‹•è³‡æ–™å¤¾åˆ—è¡¨ï¼ˆæœªå¯¦ä½œï¼Œè³‡æ–™å¤¾æ•¸é‡å°‘æ™‚ä¸éœ€è¦ï¼‰

### 3. ä½¿ç”¨è€…é«”é©—
- âœ… å³æ™‚é è¦½æ•¸é‡
- âœ… Loading ç‹€æ…‹æŒ‡ç¤º
- âœ… éŒ¯èª¤æç¤ºï¼ˆToastï¼‰
- âœ… ç¦ç”¨æŒ‰éˆ•ï¼ˆé è¦½ 0 é¡Œæ™‚ï¼‰

---

## ğŸ“ å·²çŸ¥é™åˆ¶

### 1. è³‡æ–™å¤¾æ•¸é‡é™åˆ¶
- **å•é¡Œ**: è³‡æ–™å¤¾éå¤šï¼ˆ>100ï¼‰æ™‚ï¼Œåˆ—è¡¨å¯èƒ½éé•·
- **è§£æ±º**: å·²è¨­å®š max-h-48 + overflow-y-autoï¼ˆæ»¾å‹•æ¢ï¼‰
- **æœªä¾†**: å¯è€ƒæ…®æœå°‹åŠŸèƒ½

### 2. é è¦½è¨ˆç®—æ•ˆèƒ½
- **å•é¡Œ**: æ¯æ¬¡ä¿®æ”¹ç¯©é¸éƒ½æœƒç™¼é€ API è«‹æ±‚
- **å½±éŸ¿**: ç¯©é¸å™¨è®ŠåŒ–é »ç¹æ™‚ï¼Œè«‹æ±‚éå¤š
- **è§£æ±º**: å¯è€ƒæ…® Debounceï¼ˆ300msï¼‰

### 3. æ’åºå›ºå®š
- **å•é¡Œ**: ç•¶å‰æ’åºå›ºå®šç‚ºã€ŒéŒ¯èª¤æ¬¡æ•¸é™åº + å‰µå»ºæ™‚é–“å‡åºã€
- **æœªä¾†**: å¯æ–°å¢æ’åºé¸é …ï¼ˆé›£åº¦ã€ç‹€æ…‹ã€æ™‚é–“ï¼‰

---

## ğŸ”® æœªä¾†æ“´å……

### Phase 2B: å„²å­˜ç¯©é¸é è¨­
- [ ] å…è¨±ä½¿ç”¨è€…å„²å­˜å¸¸ç”¨ç¯©é¸çµ„åˆ
- [ ] å¿«é€Ÿè¼‰å…¥é è¨­ç¯©é¸
- [ ] é è¨­ç®¡ç†ï¼ˆç·¨è¼¯ã€åˆªé™¤ï¼‰

### Phase 2C: å¿«é€Ÿç¯©é¸æŒ‰éˆ•
- [ ] ã€Œæœ€å¸¸éŒ¯ã€ï¼ˆtop 20 wrong_countï¼‰
- [ ] ã€Œå¾æœªè¤‡ç¿’ã€ï¼ˆreview_state='new'ï¼‰
- [ ] ã€Œå·²ç²¾é€šä½†ä¹…æœªè¤‡ç¿’ã€ï¼ˆreview_state='mastered' + 30 daysï¼‰
- [ ] ã€Œéš¨æ©Ÿ 10 é¡Œã€ï¼ˆlimit=10, randomï¼‰

### Phase 2D: é€²éšæ’åº
- [ ] æ’åºé¸é …ï¼šé›£åº¦ã€ç‹€æ…‹ã€æ™‚é–“ã€éŒ¯èª¤æ¬¡æ•¸
- [ ] æ’åºæ–¹å‘ï¼šå‡åºã€é™åº
- [ ] è‡ªè¨‚æ’åºæ¬Šé‡

### Phase 2E: åŒ¯å‡ºåŠŸèƒ½
- [ ] åŒ¯å‡ºç¯©é¸çµæœç‚º PDF
- [ ] åŒ¯å‡ºç¯©é¸çµæœç‚º Excel
- [ ] åˆ†äº«ç¯©é¸é€£çµ

---

## ğŸ‰ å®Œæˆç¸½çµ

### âœ… å·²å®ŒæˆåŠŸèƒ½
1. **Backend API**: å®Œæ•´å¯¦ä½œæ‰€æœ‰ç¯©é¸é‚è¼¯
2. **Client Function**: å‹åˆ¥å®‰å…¨çš„ API å‘¼å«
3. **UI Component**: å®Œæ•´çš„ç¯©é¸å™¨è¡¨å–®
4. **Integration**: ç„¡ç¸«æ•´åˆåˆ° ReviewQueue
5. **Documentation**: å®Œæ•´çš„åŠŸèƒ½æ–‡ä»¶

### ğŸ“Š ç¨‹å¼ç¢¼çµ±è¨ˆ
- **Backend**: `route.ts` (125 è¡Œ)
- **Client**: `question.api.ts` (+42 è¡Œ)
- **UI**: `CustomReviewDialog.tsx` (360 è¡Œ)
- **Integration**: `ReviewQueue.tsx` (+20 è¡Œ)
- **Total**: ~550 è¡Œç¨‹å¼ç¢¼

### ğŸ† äº®é»
- âœ¨ å³æ™‚é è¦½åŠŸèƒ½
- ğŸ¨ ç›´è§€çš„ UI è¨­è¨ˆ
- âš¡ é«˜æ•ˆçš„è³‡æ–™åº«æŸ¥è©¢
- ğŸ”„ ç„¡ç¸«çš„æ¨¡å¼åˆ‡æ›
- ğŸ“± å®Œæ•´çš„éŸ¿æ‡‰å¼æ”¯æ´

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-01-05  
**ä½œè€…**: GitHub Copilot AI Agent  
**ç‹€æ…‹**: âœ… å®Œæˆä¸¦å¯ç”¨
