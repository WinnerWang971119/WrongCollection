# ğŸ› é™¤éŒ¯æ­¥é©Ÿ - ç§»é™¤ç­†è·¡ 500 éŒ¯èª¤

## ç•¶å‰ç‹€æ…‹

âœ… ç’°å¢ƒè®Šæ•¸æ­£ç¢ºè¨­å®šï¼ˆæ¸¬è©¦è…³æœ¬é€šéï¼‰  
âœ… Replicate SDK å¯ä»¥æ­£å¸¸åˆå§‹åŒ–  
âŒ API Route å›å‚³ 500 éŒ¯èª¤

## ğŸ” é™¤éŒ¯æ­¥é©Ÿ

### Step 1: ç¢ºèª Dev Server å·²é‡æ–°å•Ÿå‹•

**é‡è¦ï¼** å¿…é ˆå…ˆå®Œæˆé€™æ­¥ï¼š

```bash
# 1. åœæ­¢ç¾æœ‰ dev server (Ctrl+C)
# 2. é‡æ–°å•Ÿå‹•
npm run dev
```

ç­‰å¾…çœ‹åˆ°ï¼š
```
âœ“ Ready in Xs
â—‹ Local:   http://localhost:3000
```

---

### Step 2: æ¸¬è©¦åŠŸèƒ½ä¸¦æŸ¥çœ‹ Terminal æ—¥èªŒ

1. é–‹å•Ÿç€è¦½å™¨å‰å¾€ http://localhost:3000/dashboard
2. æ–°å¢éŒ¯é¡Œ â†’ ä¸Šå‚³åœ–ç‰‡
3. é»æ“Šã€Œæ‰‹å‹•èª¿æ•´ã€
4. é»æ“Šã€ŒğŸ§¹ ç§»é™¤ç­†è·¡ (AI)ã€
5. **ç«‹å³æŸ¥çœ‹ Terminal**ï¼ˆå¾ˆé‡è¦ï¼ï¼‰

---

### Step 3: æª¢æŸ¥ Terminal æ—¥èªŒ

#### âœ… æ­£å¸¸çš„æ—¥èªŒæ‡‰è©²æ˜¯ï¼š

```
ğŸ§¹ [API] é–‹å§‹è™•ç†ç§»é™¤ç­†è·¡è«‹æ±‚
âœ… [API] ä½¿ç”¨è€…å·²é©—è­‰: xxxx-xxxx-xxxx
ğŸ“¥ [API] æ”¶åˆ°åœ–ç‰‡å’Œé®ç½©
âœ… [API] API Token å·²è¨­å®š: r8_28gSm...
âœ… [API] Replicate å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ  â† æ–°å¢çš„æ—¥èªŒ
ğŸ¤– [API] å‘¼å« Replicate LaMa æ¨¡å‹...
ğŸ“Š [API] åœ–ç‰‡å¤§å°: data:image/png;base64,iVBORw0KGgoAAAAN...
ğŸ“Š [API] é®ç½©å¤§å°: data:image/png;base64,iVBORw0KGgoAAAAN...
(ç­‰å¾… 5-30 ç§’...)
âœ… [API] Replicate è™•ç†å®Œæˆ (12543ms)
ğŸ“¤ [API] çµæœ URL: https://replicate.delivery/...
```

#### âŒ å¦‚æœå‡ºç¾éŒ¯èª¤ï¼š

**æƒ…æ³ Aï¼šToken æœªè¼‰å…¥**
```
ğŸ§¹ [API] é–‹å§‹è™•ç†ç§»é™¤ç­†è·¡è«‹æ±‚
âŒ [API] ç¼ºå°‘ REPLICATE_API_TOKEN ç’°å¢ƒè®Šæ•¸
```
â†’ **è§£æ±º**ï¼šDev server æœªé‡æ–°å•Ÿå‹•ï¼Œå›åˆ° Step 1

---

**æƒ…æ³ Bï¼šReplicate åˆå§‹åŒ–å¤±æ•—**
```
ğŸ§¹ [API] é–‹å§‹è™•ç†ç§»é™¤ç­†è·¡è«‹æ±‚
âœ… [API] API Token å·²è¨­å®š: r8_28gSm...
âŒ [API] Replicate åˆå§‹åŒ–å¤±æ•—: [éŒ¯èª¤è¨Šæ¯]
```
â†’ **è§£æ±º**ï¼šæŸ¥çœ‹å…·é«”éŒ¯èª¤è¨Šæ¯ï¼Œå¯èƒ½æ˜¯ï¼š
- Replicate å¥—ä»¶å®‰è£å•é¡Œ â†’ `npm install replicate --force`
- Token æ ¼å¼éŒ¯èª¤ â†’ æª¢æŸ¥ `.env.local`

---

**æƒ…æ³ Cï¼šAPI å‘¼å«å¤±æ•—**
```
âœ… [API] Replicate å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
ğŸ¤– [API] å‘¼å« Replicate LaMa æ¨¡å‹...
âŒ [API] Replicate API éŒ¯èª¤: [éŒ¯èª¤è¨Šæ¯]
```
â†’ **è§£æ±º**ï¼šæ ¹æ“šéŒ¯èª¤è¨Šæ¯ï¼š
- `unauthorized` â†’ Token ç„¡æ•ˆ
- `quota exceeded` â†’ é¡åº¦ä¸è¶³
- `timeout` â†’ ç­‰å¾…å¾Œé‡è©¦
- `invalid input` â†’ åœ–ç‰‡æ ¼å¼å•é¡Œ

---

**æƒ…æ³ Dï¼šèªè­‰å¤±æ•—**
```
ğŸ§¹ [API] é–‹å§‹è™•ç†ç§»é™¤ç­†è·¡è«‹æ±‚
âŒ [API] æœªæˆæ¬Š
```
â†’ **è§£æ±º**ï¼šä½¿ç”¨è€…æœªç™»å…¥ï¼Œè«‹å…ˆç™»å…¥

---

**æƒ…æ³ Eï¼šå…¶ä»–éŒ¯èª¤**
```
âŒ [API] ç§»é™¤ç­†è·¡å¤±æ•—: [éŒ¯èª¤è¨Šæ¯]
âŒ [API] éŒ¯èª¤è©³æƒ…: { message: ..., name: ..., stack: ... }
```
â†’ **è§£æ±º**ï¼šæŸ¥çœ‹è©³ç´°çš„éŒ¯èª¤å †ç–Š

---

### Step 4: æª¢æŸ¥ç€è¦½å™¨ Console

é–‹å•Ÿ DevTools â†’ Console Tabï¼Œæ‡‰è©²çœ‹åˆ°ï¼š

#### âœ… æˆåŠŸï¼š
```
ğŸ§¹ é–‹å§‹ç§»é™¤ç­†è·¡...
ğŸ” æ­£åœ¨æª¢æ¸¬ç­†è·¡...
âœ… Step 1: è½‰æ›ç‚ºç°éš
âœ… Step 2: äºŒå€¼åŒ–æª¢æ¸¬ç­†è·¡
âœ… Step 3: è†¨è„¹è™•ç†ï¼ˆé€£æ¥ç­†ç•«ï¼‰
âœ… Step 4: ç§»é™¤é›œè¨Šï¼ˆä¿ç•™ X å€‹ç­†è·¡å€åŸŸï¼‰
âœ… ç­†è·¡æª¢æ¸¬å®Œæˆ: { regions: 3, area: 12543, percentage: "2.34%" }
ğŸ“¤ æ­£åœ¨å‘¼å« AI æ¨¡å‹...
ğŸ§¹ å‘¼å« AI ç§»é™¤ç­†è·¡ API...
âœ… AI ç§»é™¤ç­†è·¡æˆåŠŸ (8234ms)
```

#### âŒ å¤±æ•—ï¼š
```
âŒ API éŒ¯èª¤å›æ‡‰: {
  status: 500,
  statusText: "Internal Server Error",
  error: { error: "...", details: "..." }
}
âŒ ç§»é™¤ç­†è·¡éŒ¯èª¤: Error: [500] ...
```

å¦‚æœæ˜¯ 500 éŒ¯èª¤ï¼Œ**ç«‹å³å›åˆ° Terminal æŸ¥çœ‹è©³ç´°æ—¥èªŒ**ã€‚

---

### Step 5: å¸¸è¦‹å•é¡Œå¿«é€Ÿæª¢æŸ¥

#### Q1: çœ‹åˆ°ã€ŒâŒ [API] ç¼ºå°‘ REPLICATE_API_TOKENã€ï¼Ÿ
âœ… **è§£æ±º**ï¼šé‡æ–°å•Ÿå‹• dev server

```bash
# Terminal æŒ‰ Ctrl+C åœæ­¢
npm run dev
```

---

#### Q2: çœ‹åˆ°ã€ŒâŒ [API] Replicate åˆå§‹åŒ–å¤±æ•—ã€ï¼Ÿ
âœ… **è§£æ±º**ï¼šé‡æ–°å®‰è£ Replicate

```bash
npm install replicate --force
npm run dev
```

---

#### Q3: çœ‹åˆ°ã€ŒâŒ [API] Replicate API éŒ¯èª¤: unauthorizedã€ï¼Ÿ
âœ… **è§£æ±º**ï¼šToken å¯èƒ½éæœŸæˆ–éŒ¯èª¤

1. å‰å¾€ https://replicate.com/account/api-tokens
2. æª¢æŸ¥ Token ç‹€æ…‹
3. å¦‚æœéœ€è¦ï¼Œé‡æ–°ç”Ÿæˆ
4. æ›´æ–° `.env.local`
5. é‡æ–°å•Ÿå‹• dev server

---

#### Q4: å®Œå…¨æ²’æœ‰ Terminal æ—¥èªŒï¼Ÿ
âœ… **è§£æ±º**ï¼š

1. ç¢ºèª dev server æ­£åœ¨é‹è¡Œ
2. ç¢ºèªç€è¦½å™¨æ­£åœ¨è¨ªå• `http://localhost:3000`ï¼ˆä¸æ˜¯å…¶ä»–ç«¯å£ï¼‰
3. æ¸…é™¤ç€è¦½å™¨å¿«å–å¾Œé‡è©¦

---

## ğŸ“‹ å®Œæ•´æª¢æŸ¥æ¸…å–®

åŸ·è¡Œä»¥ä¸‹æ‰€æœ‰æ­¥é©Ÿï¼š

- [ ] Step 1: åœæ­¢ä¸¦é‡æ–°å•Ÿå‹• dev server
- [ ] Step 2: ç­‰å¾…ã€Œâœ“ Readyã€è¨Šæ¯
- [ ] Step 3: å‰å¾€ http://localhost:3000/dashboard
- [ ] Step 4: ä¸Šå‚³åœ–ç‰‡ä¸¦é»æ“Šã€Œç§»é™¤ç­†è·¡ã€
- [ ] Step 5: **ç«‹å³æŸ¥çœ‹ Terminal**ï¼ˆä¸è¦åªçœ‹ç€è¦½å™¨ï¼‰
- [ ] Step 6: è¤‡è£½å®Œæ•´çš„ Terminal æ—¥èªŒ
- [ ] Step 7: è¤‡è£½å®Œæ•´çš„ Browser Console æ—¥èªŒ

---

## ğŸ†˜ å¦‚æœé‚„æ˜¯å¤±æ•—

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š

### 1. Terminal å®Œæ•´æ—¥èªŒ
å¾ã€ŒğŸ§¹ [API] é–‹å§‹è™•ç†ã€é–‹å§‹ï¼Œç›´åˆ°éŒ¯èª¤çµæŸ

### 2. Browser Console å®Œæ•´æ—¥èªŒ
å¾ã€ŒğŸ§¹ é–‹å§‹ç§»é™¤ç­†è·¡ã€é–‹å§‹ï¼Œç›´åˆ°éŒ¯èª¤çµæŸ

### 3. æ¸¬è©¦è…³æœ¬è¼¸å‡º
```bash
node scripts/test-replicate-token.js
```

### 4. Dev Server å•Ÿå‹•æ—¥èªŒ
```bash
npm run dev
```
è¤‡è£½æ‰€æœ‰è¼¸å‡ºï¼ˆç‰¹åˆ¥æ˜¯æœ‰ç„¡éŒ¯èª¤è¨Šæ¯ï¼‰

### 5. ç’°å¢ƒè®Šæ•¸æª¢æŸ¥
```bash
# PowerShell
$env:REPLICATE_API_TOKEN.Substring(0,8)

# æ‡‰è©²é¡¯ç¤º: r8_28gSm
```

---

## ğŸ’¡ é—œéµæç¤º

1. **Always restart dev server** after changing `.env.local`
2. **Terminal logs are more important** than browser errors for API issues
3. **First API call takes 15-30s** (cold start is normal)
4. **Check Terminal immediately** after clicking the button

---

ç¾åœ¨è«‹åŸ·è¡Œ Step 1-5ï¼Œç„¶å¾Œå‘Šè¨´æˆ‘ä½ åœ¨ Terminal çœ‹åˆ°ä»€éº¼ï¼
